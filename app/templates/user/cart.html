{% extends "user/base.html" %}

{% block content %}
<div class="untree_co-section" style="padding-bottom: 30px;">
  <div class="container">
    <h2 class="section-heading mt-5">Your Cart</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    
    {% if cart_items %}
      <!-- Custom CSS for Mobile Responsiveness -->
      <style>
        /* General table styling */
        .table {
          font-size: 0.9rem;
        }

        .table th, .table td {
          padding: 10px;
          vertical-align: middle;
        }

        .table img {
          width: 50px;
          height: 50px;
          object-fit: cover;
        }

        .table .btn-sm {
          padding: 5px 10px;
          font-size: 0.85rem;
        }

        /* Total amount and checkout button */
        .total-amount {
          font-size: 1.1rem;
          margin: 20px 0;
        }

        .btn-primary {
          font-size: 0.9rem;
          padding: 10px 20px;
        }

        /* Mobile responsiveness */
        @media (max-width: 767.98px) {
          .table-responsive {
            border: none;
          }

          .table thead {
            display: none; /* Hide table headers on mobile */
          }

          .table tbody tr {
            display: block;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
          }

          .table tbody td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border: none;
            font-size: 0.85rem;
          }

          .table tbody td::before {
            content: attr(data-label);
            font-weight: bold;
            margin-right: 10px;
            flex: 0 0 40%;
          }

          .table tbody td .d-flex {
            flex-direction: column;
            align-items: flex-start;
          }

          .table tbody td .d-flex img {
            margin-bottom: 10px;
          }

          .table tbody td .d-flex span {
            margin-left: 0;
          }

          .table tbody td form {
            width: 100%;
          }

          .table tbody td .btn-sm {
            width: 100%;
            text-align: center;
          }

          .total-amount {
            font-size: 1rem;
            text-align: center;
          }

          .btn-primary {
            display: block;
            width: 100%;
            text-align: center;
            font-size: 0.85rem;
          }
        }

        @media (max-width: 575.98px) {
          .table tbody td {
            font-size: 0.8rem;
          }

          .table tbody td::before {
            flex: 0 0 50%;
          }

          .table img {
            width: 40px;
            height: 40px;
          }

          .table .btn-sm {
            font-size: 0.8rem;
            padding: 4px 8px;
          }

          .total-amount {
            font-size: 0.9rem;
          }

          .btn-primary {
            font-size: 0.8rem;
            padding: 8px 15px;
          }
        }
      </style>

      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Size</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for item in cart_items %}
              <tr>
                <td data-label="Product">
                  <div class="d-flex align-items-center">
                    <img src="/static/{{ item.images_list[0] if item.images_list else 'user/images/product-1.png' }}" class="img-fluid" alt="{{ item.product_name }}">
                    <span class="ms-2">{{ item.product_name }}</span>
                  </div>
                </td>
                <td data-label="Size">{{ item.size }}</td>
                <td data-label="Quantity">{{ item.quantity }}</td>
                <td data-label="Price">${{ '%.2f'|format(item.size_price) }}</td>
                <td data-label="Total">${{ '%.2f'|format(item.size_price * item.quantity) }}</td>
                <td data-label="Action">
                  <form method="POST" action="{{ url_for('user.remove_from_cart', id=item.id) }}">
                    <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <p class="total-amount"><strong>Total Amount: </strong>${{ '%.2f'|format(total_amount) }}</p>
      <a href="{{ url_for('user.checkout') }}" class="btn btn-primary">Proceed to Checkout</a>
    {% else %}
      <p>Your cart is empty.</p>
    {% endif %}
  </div>
</div>
{% endblock %}